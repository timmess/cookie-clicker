
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <title>Hello React</title>
    <!-- Library -->
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>

    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <!-- babel => compilation du JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="css/app.css">
</head>

<body>
<div id="root"></div>
<script type="text/babel">

  // Création de composant en créant des classes
  
  class GlobalIncomeRiseButton extends React.Component{
    constructor(props){
        super(props);
    }

    render() {
        return(
            <div>
                <button className="btn btn-success" disabled={this.props.disabled} onClick={this.props.click}>Augmenter</button>
            </div>
        )
    }
  }

  class App extends React.Component {

    constructor() {
        super();
        this.state = {
            counter: 50,
            bigCookies: 0,
            cookiesPerSecond: 0,
            clicks: 0,
            mothers: 99,
            cooks: 0,
            interval: 1000,
            message: "",
            successes:
                    [
                        {
                            name: "Un petit effort...",
                            clicks: 10,
                            message: "Bravo, vous avez clické 10 fois",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Il y a du pain sur la planche !!",
                            clicks: 50,
                            message: "Bravo, vous avez clické 50 fois",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "La pâte commence à monter !",
                            clicks: 100,
                            message: "Bravo, vous avez clické 100 fois",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Tu t'es levé tôt !",
                            clicks: 250,
                            message: "Bravo, vous avez clické 250 fois",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Maitre cuisinier !",
                            clicks: 1000,
                            message: "Bravo, vous avez clické 1000 fois",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Où ai-je mis mon dentier ??",
                            mothers: 1,
                            message: "Bravo, vous avez acheté 1 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Il va falloir plus de cannes...",
                            mothers: 10,
                            message: "Bravo, vous avez acheté 10 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Tu es la bonne voie, fils !",
                            mothers: 50,
                            message: "Bravo, vous avez acheté 50 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Directeur d'EHPAD",
                            mothers: 100,
                            message: "Bravo, vous avez acheté 100 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Bourreau des coeurs",
                            mothers: 1000,
                            message: "Bravo, vous avez acheté 100 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Apprenti cuisinier",
                            cooks: 1,
                            message: "Bravo, vous avez acheté 1 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Tu commences à prendre du gallon",
                            cooks: 10,
                            message: "Bravo, vous avez acheté 10 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Tu veux être chef ?",
                            cooks: 50,
                            message: "Bravo, vous avez acheté 50 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Ton nom c'est Philippe ?",
                            cooks: 100,
                            message: "Bravo, vous avez acheté 100 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                        {
                            name: "Animateur Top Chef",
                            cooks: 1000,
                            message: "Bravo, vous avez acheté 100 grand-mères",
                            complete: false,
                            isDisplayed : false,
                            isClicked: false,
                        },
                    ],
        }

        this.incrementCounter = this.incrementCounter.bind(this);
        this.updateCookiesCounter = this.updateCookiesCounter.bind(this);
        this.recruitMother = this.recruitMother.bind(this);
        this.recruitCook = this.recruitCook.bind(this);
        this.setComplete = this.setComplete.bind(this);
        this.updateCookieCounterBySuccess = this.updateCookieCounterBySuccess.bind(this);
        this.componentDidUpdate = this.componentDidUpdate.bind(this);
        this.lowerInterval = this.lowerInterval.bind(this);
        this.test = this.test.bind(this);
        this.setClicked = this.setClicked.bind(this);

        this.interval = setInterval(this.updateCookiesCounter, this.state.interval);
    }

    render() {
        return (
        <div className="appMargin">
            <div className="container align-self-center">
                <div className="row">
                    
                    <div className="col-3 colorNougat rounded">
                        <div className="m-2">
                            <h4 className="text-center">Succès à débloquer : </h4>
                            <ul>
                                {this.state.successes.map((success, index) =>
                                    <li key={index}>{success.name} {success.complete === true ? " : Complété !" : ""}</li>
                                )}
                            </ul>      
                        </div>
                    </div>

                    <div className="col-6 text-center rounded padding50">
                        
                        <h1 className="mb-5">Cookie clicker</h1>

                        <h2>Cookies : {this.state.counter}</h2>

                        <h2>Gros cookies : {this.state.bigCookies}</h2>

                        <h3>Cookies par seconde : {this.state.cookiesPerSecond}</h3>

                        <h2>Nombre de clicks : {this.state.clicks}</h2>

                        <img className="Cookie" onClick={this.incrementCounter} src={"./img/cookie.jpg"}/>
                        {this.state.message && <div className="alert">{this.state.message}</div>}
                    </div>
                    
                    <div className="col-3 colorNougat rounded">
                        <div className="m-2">
                            <ul>
                                <h3 className="text-center">Vos clickers :</h3>
                                {this.state.counter === 0 && 
                                    <div>
                                        <h2 className="text-center mt-5">Cliquez sur le cookie !!!</h2>
                                        <h2 className="text-center mt-5">Vite !!!</h2>
                                    </div>
                                }
                                
                                {this.state.mothers >= 1 && 
                                    //A factoriser et mettre dans un .map
                                    <li className="my-3">
                                        Grand-mères : {this.state.mothers} (+{this.state.mothers} cookies / s)
                                    </li>
                                }
                                {this.state.cooks >= 1 && 
                                    <li className="my-3">
                                        Cuisiniers : {this.state.cooks} (+{this.state.cooks * 5} cookies / s)
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div className="container">
                <div className="row">
                    <div className="col-4 text-center mt-3 colorNougat padding10">
                        
                        <h3>Travailleurs :</h3>
                        {this.state.counter >= 50 ?
                            <div className="mt-3">
                                <button className="btn btn-dark" onClick={this.recruitMother}>Recruter une grand mère</button>
                                <p>(+1 cookie par seconde)</p>
                            </div>

                            :

                            <p>Il vous faut plus de cookies !!!</p>
                        }

                        {this.state.counter >= 500 &&
                            <div className="mt-3">
                                <button className="btn btn-dark" onClick={this.recruitCook}>Recruter un cuisinier</button>
                                <p>(+5 cookie par seconde)</p>
                            </div>
                        }    
                    </div>   

                    <div className="col-4 padding30">
                        {this.state.successes.map((success, index) => success.clicks === this.state.clicks &&
                            <div key={index} className="container mt-2">
                                <div className="col-12 text-center">
                                    <div className="alert alert-success mb-0">
                                        {success.message}
                                    </div>
                                </div> 
                            </div>
                        )}  
                        
                        {this.state.successes.map((success, index) => success.mothers === this.state.mothers &&
                            <div key={index} className="container mt-2">
                                <div className="col-12 text-center">
                                    <div className="alert alert-success mb-0">
                                        {success.message}
                                    </div>
                                </div> 
                            </div>
                        )}     
                        
                        {this.state.successes.map((success, index) => success.cooks === this.state.cooks &&
                            <div key={index} className="container mt-2">
                                <div className="col-12 text-center">
                                    <div className="alert alert-success mb-0">
                                        {success.message}
                                    </div>
                                </div> 
                            </div>
                        )}
                    </div>

                    <div className="col-4 text-center mt-3 colorNougat padding10">
                        <h3>Améliorations :</h3>
                        {this.state.mothers >= 10 ?
                            <div>
                                <h5>Augmenter le revenu global de 100% !!</h5>
                                {this.state.successes.map((success, index) => 
                                    <div>
                                        {success.name} <GlobalIncomeRiseButton key={index} disabled={success.isClicked === true} click={() => this.updateCookieCounterBySuccessSetClicked()}/>  
                                    </div>
                                )}
                            </div>
                            :
                            <div>
                                <p>Jouez pour accéder aux amélioration ! ;)</p>
                            </div>
                        }

                        {this.state.bigCookies >= 10 && 
                            <div>
                                <h5>Dimnuer le temps de production de cookie !!</h5>
                                <GlobalIncomeRiseButton click={() => this.lowerInterval()} />
                            </div>
                        }
                    </div>   
                </div>  
                <button onClick={this.test}>test</button>
            </div>
        </div>
        )
    }

    test(){
        console.log(this.state.successes)
    }

    
    
    componentDidUpdate(previousProps, previousState) {
        // Met à jour le state "complete" des success à true si les clicks du container ont atteint les clicks du success
        for (let i = 0; i < this.state.successes.length; i++) {
            if(this.state.clicks === this.state.successes[i].clicks && previousState.successes[i].complete == false){
                this.setComplete(i)
            }
            if(this.state.mothers === this.state.successes[i].mothers && previousState.successes[i].complete == false){
                this.setComplete(i)
            }
            if(this.state.cooks === this.state.successes[i].cooks && previousState.successes[i].complete == false){
                this.setComplete(i)
            }
        }
    }

    updateCookieCounterBySuccessSetClicked() {
        this.updateCookieCounterBySuccess()
        this.setClicked()
    }
    
    setClicked(){
        const newSuccesses = this.state.successes;

        for (let i = 0; i < this.state.successes.length; i++) 
        {
            if(this.state.clicks >= this.state.successes[i].clicks){
                newSuccesses[i].isClicked = !newSuccesses[i].isClicked
            }
        }

        this.setState({
            successes: newSuccesses
        })
    }

    /**
     * Met à jour les states complete et isDisplayed d'un succès à son inverse (bool)    
     */
    setComplete(index) {
        
        const newSuccesses = this.state.successes;

        newSuccesses[index].complete = !newSuccesses[index].complete
        newSuccesses[index].isDisplayed = !newSuccesses[index].isDisplayed
        
        this.setState({
            successes: newSuccesses
        })
    }

    /**
     *  Met à jour l'intervale en la diminuant de 10 ms
     */
    lowerInterval() {
        this.interval = setInterval(this.updateCookiesCounter, this.state.interval - 10);
    }
    
    /**
     * Mettre à jour le nombre cookies en lui ajoutant le cookiesPerSecond
     */
    updateCookiesCounter() {
        this.setState({
            counter: this.state.counter + this.state.cookiesPerSecond
        })
    }

    /**
     *  Fonction qui permet d'améliorer le nombre de cookie par seconde suite à la réalisation d'un succès
     */
    updateCookieCounterBySuccess() {
        this.setState({
            cookiesPerSecond: this.state.cookiesPerSecond * 2,
        })
    }

    /**
     * Augmenter le débit des cookies de 1
     */
    recruitMother() {
        this.setState({
            cookiesPerSecond: this.state.cookiesPerSecond + 1,
            mothers: this.state.mothers +1,
        })
    }

    /**
     * Augmenter le débit des cookies de 5
     */
    recruitCook() {
        this.setState({
            cookiesPerSecond: this.state.cookiesPerSecond +5,
            cooks: this.state.cooks +1,
        })
    }

    /**
     * Augmenter de 1 la valeur du state de counter
     */
    incrementCounter() {
        this.setState({
            counter: this.state.counter + 1,
            clicks: this.state.clicks +1,
        })

        const a = Math.floor((Math.random() * 100) + 1);
        const b = Math.floor((Math.random() * 100) + 1);

        if (a === b) {
            this.setState({
                counter: this.state.counter + 9,
                bigCookies: this.state.bigCookies +1
            })
        }
      }
  }

  // Rendu dans le DOM
  ReactDOM.render(
    <App/>,
    document.getElementById('root')
  );
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
</body>

</html>