
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <title>Hello React</title>
    <!-- Library -->
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>

    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <!-- babel => compilation du JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="css/app.css">
</head>

<body>
<div id="root"></div>
<script type="text/babel">

  // Création de composant en créant des classes
  
  class GlobalIncomeRiseButton extends React.Component{
    constructor(props){
        super(props);
    }

    render() {
        return(
            <div>
                <span>Augmenter le revenu global</span>
                <br/>
                <button className="btn btn-success" onClick={this.props.click}>Augmenter</button>
            </div>
        )
    }
  }

  class App extends React.Component {

    constructor() {
        super();
        this.state = {
            counter: 0,
            cookiesPerSecond: 0,
            clicks: 0,
            mothers: 0,
            cooks: 0,
            successes:
                    [
                        {
                            name: "10 clicks",
                            clicks: 10,
                            message: "Bravo, vous avez clické 10 fois",
                            complete: false,
                            isDisplayed : false,
                        },
                        {
                            name: "100 clicks",
                            clicks: 100,
                            message: "Bravo, vous avez clické 100 fois",
                            complete: false,
                            isDisplayed : false,
                        },
                        {
                            name: "1000 clicks",
                            clicks: 1000,
                            message: "Bravo, vous avez clické 1000 fois",
                            complete: false,
                            isDisplayed : false,
                        },
                    ],
            interval: 1000,
        }

        this.incrementCounter = this.incrementCounter.bind(this);
        this.updateCookiesCounter = this.updateCookiesCounter.bind(this);
        this.recruitMother = this.recruitMother.bind(this);
        this.recruitCook = this.recruitCook.bind(this);
        this.setComplete = this.setComplete.bind(this);
        this.updateCookieCounterBySuccess = this.updateCookieCounterBySuccess.bind(this);
        this.componentDidUpdate = this.componentDidUpdate.bind(this);
        this.lowerInterval = this.lowerInterval.bind(this);
        this.test = this.test.bind(this);

        this.interval = setInterval(this.updateCookiesCounter, this.state.interval);
    }

    render() {
        return (
        <div className="appMargin">
            <div className="container align-self-center">
                <div className="row">
                    
                    <div className="col-3 colorNougat rounded">
                        <div className="m-2">
                            <h4 className="text-center">Succès à débloquer : </h4>
                            <ul>
                                {this.state.successes.map((success, index) =>
                                    <li key={index}>{success.name} {success.complete === true ? " : Complété !" : ""}</li>
                                )}
                            </ul>      
                        </div>
                    </div>

                    <div className="col-6 text-center rounded padding50">

                        <h1 className="mb-5">Cookie clicker</h1>

                        <h2>Cookies : {this.state.counter}</h2>

                        <h3>Cookies par seconde : {this.state.cookiesPerSecond}</h3>

                        <h2>Nombre de clicks : {this.state.clicks}</h2>

                        <img className="Cookie" onClick={this.incrementCounter} src={"./img/cookie.jpg"}/>
                    </div>
                    
                    <div className="col-3 colorNougat rounded">
                        <div className="m-2">
                            <ul>
                                <h3 className="text-center">Vos clickers :</h3>
                                {this.state.counter === 0 && 
                                    <div>
                                        <h2 className="text-center mt-5">Cliquez sur le cookie !!!</h2>
                                        <h2 className="text-center mt-5">Vite !!!</h2>
                                    </div>
                                }
                                
                                {this.state.mothers >= 1 && 
                                    //A factoriser et mettre dans un map
                                    <li className="my-3">
                                        Grand-mères : {this.state.mothers} (+{this.state.mothers} cookies / s)
                                    </li>
                                }
                                {this.state.cooks >= 1 && 
                                    <li className="my-3">
                                        Cuisiniers : {this.state.cooks} (+{this.state.cooks * 5} cookies / s)
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            {this.state.successes.map((success, index) => success.clicks === this.state.clicks &&
                    <div key={index} className="container mt-2">
                        <div className="col-12 text-center">
                            <div className="alert alert-success mb-0">
                                {success.message}
                            </div>
                        </div> 
                    </div>
            )}

            <div className="container">
                <div className="row">
                    <div className="col-4 text-center mt-3 colorNougat">
                        
                        <h3>Travailleurs :</h3>
                        {this.state.counter >= 10 &&
                            <div className="mt-3">
                                <button className="btn btn-dark" onClick={this.recruitMother}>Recruter une grand mère</button>
                                <p>(+1 cookie par seconde)</p>
                            </div>
                        }

                        {this.state.counter >= 500 &&
                            <div className="mt-3">
                                <button className="btn btn-dark" onClick={this.recruitCook}>Recruter un cuisinier</button>
                                <p>(+5 cookie par seconde)</p>
                            </div>
                        }    
                    </div>    
                    <div className="col-4"></div>
                    <div className="col-4 text-center mt-3 colorNougat">
                        <h3>Améliorations :</h3>
                        {this.state.successes[0].complete === true &&
                            <div>
                                <GlobalIncomeRiseButton click={this.updateCookieCounterBySuccess}/>    
                            </div>
                        }
                    </div>   
                </div>  
                
            </div>
        </div>
        )
    }

    test(){
        console.log(this.state.successes)
    }

    componentDidUpdate(previousProps, previousState) {
        // Met à jour le state "complete" des success à true si les clicks du container ont atteint les clicks du success
        for (let i = 0; i < this.state.successes.length; i++) {
            if(this.state.clicks === this.state.successes[i].clicks && previousState.successes[i].complete == false){
                this.setComplete(i)
            }
        }
    }

    /**
     * Met à jour les states complete et isDisplayed d'un succès à son inverse (bool)    
     */
    setComplete(index) {
        
        const newSuccesses = this.state.successes;

        newSuccesses[index].complete = !newSuccesses[index].complete
        newSuccesses[index].isDisplayed = !newSuccesses[index].isDisplayed
        
        this.setState({
            successes: newSuccesses
        })
    }

    /**
     *  Met à jour l'intervale en la diminuant de 10 ms
     */
    lowerInterval() {
        this.interval = setInterval(this.updateCookiesCounter, this.state.interval - 10);
    }
    
    /**
     * Mettre à jour le nombre cookies en lui ajoutant le cookiesPerSecond
     */
    updateCookiesCounter() {
        this.setState({
            counter: this.state.counter + this.state.cookiesPerSecond
        })
    }

    /**
     *  Fonction qui permet d'améliorer le nombre de cookie par seconde suite à la réalisation d'un succès
     */
    updateCookieCounterBySuccess() {
        this.setState({
            cookiesPerSecond: this.state.cookiesPerSecond * 2
        })
    }

    /**
     * Augmenter le débit des cookies de 1
     */
    recruitMother() {
        this.setState({
            cookiesPerSecond: this.state.cookiesPerSecond + 1,
            mothers: this.state.mothers +1,
        })
    }

    /**
     * Augmenter le débit des cookies de 5
     */
    recruitCook() {
        this.setState({
            cookiesPerSecond: this.state.cookiesPerSecond +5,
            cooks: this.state.cooks +1,
        })
    }


    /**
     * Augmenter de 1 la valeur du state de counter
     */
    incrementCounter() {
          this.setState({
              counter: this.state.counter + 1,
              clicks: this.state.clicks +1,
          })
      }
  }

  // Rendu dans le DOM
  ReactDOM.render(
    <App/>,
    document.getElementById('root')
  );
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
</body>

</html>